package com.aws.proj1.repo.impl;

import com.aws.ccproject.config.AwsConfiguration;
import com.aws.proj1.repo.Ec2Repo;
import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import com.amazonaws.services.ec2.model.TerminateInstancesRequest;
import com.amazonaws.util.EC2MetadataUtils;

@Slf4j
@Repository
public class Ec2RepoImpl implements Ec2Repo {

	private static final Logger LOGGER = LoggerFactory.getLogger(Ec2RepoImpl.class);
	private static final String ENDING_INSTANCE="Ending the instance itself.";

	@Autowired
	private AwsConfiguration awsConfiguration;

	public void endInstance() {
//		log.info(ENDING_INSTANCE);
		String myId = EC2MetadataUtils.getInstanceId();
		if(myId !=null) {
			TerminateInstancesRequest request = new TerminateInstancesRequest().withInstanceIds(myId);
			awsConfiguration.amazonEC2().terminateInstances(request);
		}
	}

}
